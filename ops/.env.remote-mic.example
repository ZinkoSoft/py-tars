# Remote Microphone Configuration
# Copy this file to .env and configure for your environment

# =============================================================================
# REQUIRED: MQTT Connection to Main TARS System
# =============================================================================
# Set MQTT_HOST to the IP address or hostname of your main TARS system
# Example: MQTT_HOST=192.168.1.100
# Find your main TARS system IP with: ip addr show | grep "inet " | grep -v 127.0.0.1

MQTT_HOST=192.168.1.100
MQTT_PORT=1883

# =============================================================================
# OPTIONAL: Audio Device Configuration
# =============================================================================
# Leave empty for automatic detection of audio device
# If you have multiple microphones, specify the exact device name
# List available devices with: arecord -l
# Example: AUDIO_DEVICE_NAME=USB Audio Device

AUDIO_DEVICE_NAME=

# =============================================================================
# Logging Configuration
# =============================================================================
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# =============================================================================
# Audio Processing Settings
# =============================================================================
# Sample rate in Hz (16000 recommended for speech)
SAMPLE_RATE=16000

# Voice Activity Detection aggressiveness (0-3, higher = more aggressive)
VAD_AGGRESSIVENESS=3

# Chunk duration in milliseconds (20ms recommended)
CHUNK_DURATION_MS=20

# Silence threshold before ending transcription (milliseconds)
SILENCE_THRESHOLD_MS=600

# =============================================================================
# Wake Word Detection Settings
# =============================================================================
# Path to audio fanout socket (shared between stt-worker and wake-activation)
WAKE_AUDIO_FANOUT=/tmp/tars/audio-fanout.sock

# Path to wake word model (TensorFlow Lite)
WAKE_MODEL_PATH=/models/openwakeword/hey_tars.tflite

# Wake word detection threshold (0.0-1.0, lower = more sensitive)
# Default: 0.35, Recommended range: 0.25-0.45
WAKE_DETECTION_THRESHOLD=0.35

# Minimum time between wake word detections (seconds)
WAKE_MIN_RETRIGGER_SEC=0.8

# Speex noise suppression (0 = disabled, 1 = enabled)
WAKE_SPEEX_NOISE_SUPPRESSION=1

# VAD threshold for wake word detection (0.0-1.0)
WAKE_VAD_THRESHOLD=0.3

# Energy boost factor for low-volume environments (1.0-2.0)
WAKE_ENERGY_BOOST_FACTOR=1.2

# Low energy threshold factor (0.5-1.0)
WAKE_LOW_ENERGY_THRESHOLD_FACTOR=0.7

# Background noise sensitivity (0 = low, 1 = medium, 2 = high)
WAKE_BACKGROUND_NOISE_SENSITIVITY=1

# Wait for STT service health before starting (0 = disabled, 1 = enabled)
WAKE_WAIT_FOR_STT_HEALTH=1

# Timeout for STT health check (seconds)
WAKE_STT_HEALTH_TIMEOUT_SEC=30

# =============================================================================
# Speech-to-Text Settings
# =============================================================================
# Whisper model size: tiny, base, small, medium, large
# small = good balance of accuracy and performance
# tiny = fastest but less accurate
# medium/large = higher accuracy but slower and more memory
WHISPER_MODEL=small

# STT backend: whisper (local) or ws (WebSocket - requires separate STT server)
STT_BACKEND=whisper

# =============================================================================
# NPU Acceleration (Optional - for RK3588 devices like Radxa Zero 3W)
# =============================================================================
# Enable NPU acceleration for wake word detection (0 = disabled, 1 = enabled)
# Requires RKNN model: /models/openwakeword/hey_tars.rknn
WAKE_USE_NPU=0

# Path to RKNN model (NPU-optimized wake word model)
WAKE_RKNN_MODEL_PATH=/models/openwakeword/hey_tars.rknn

# NPU core mask (0 = auto, 1 = core 0, 2 = core 1, 4 = core 2)
WAKE_NPU_CORE_MASK=0

# RKNN log level (0 = verbose, 3 = errors only)
RKNN_LOG_LEVEL=3

# =============================================================================
# FFT Visualization (Optional - disabled by default for remote deployment)
# =============================================================================
# Publish FFT data to MQTT (0 = disabled, 1 = enabled)
FFT_PUBLISH=0

# FFT update rate (Hz)
FFT_RATE_HZ=12

# Number of FFT bins
FFT_BINS=64

# Use logarithmic scale for FFT (0 = linear, 1 = log)
FFT_LOG_SCALE=1

# Enable FFT WebSocket server (0 = disabled, 1 = enabled)
FFT_WS_ENABLE=0

# FFT WebSocket host (0.0.0.0 = all interfaces)
FFT_WS_HOST=0.0.0.0

# FFT WebSocket port
FFT_WS_PORT=8765

# FFT WebSocket path
FFT_WS_PATH=/fft

# =============================================================================
# Noise Floor Calibration
# =============================================================================
# Calibration duration at startup (seconds)
NOISE_FLOOR_CALIB_SECS=2.0

# Enable noise floor calibration (0 = disabled, 1 = enabled)
NOISE_FLOOR_CALIB_ENABLE=1

# Enable adaptive noise floor updates (0 = disabled, 1 = enabled)
NOISE_FLOOR_ADAPTIVE_ENABLE=1

# Noise floor threshold multiplier for detection
NOISE_FLOOR_THRESHOLD_MULTIPLIER=3.0

# Update interval for adaptive noise floor (frames)
NOISE_FLOOR_UPDATE_INTERVAL=50
