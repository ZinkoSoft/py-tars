{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ConfigUpdatePayload",
  "description": "MQTT payload for system/config/<service> topic - signed configuration update",
  "type": "object",
  "required": ["version", "service", "config", "checksum", "config_epoch", "issued_at", "signature"],
  "additionalProperties": false,
  "properties": {
    "version": {
      "type": "integer",
      "description": "Message format version",
      "const": 1
    },
    "service": {
      "type": "string",
      "description": "Target service name",
      "pattern": "^[a-z][a-z0-9-]*$",
      "examples": ["stt-worker", "tts-worker", "router", "llm-worker"]
    },
    "config": {
      "type": "object",
      "description": "Complete service configuration (service-specific schema)",
      "additionalProperties": true
    },
    "checksum": {
      "type": "string",
      "description": "SHA256 hash of config JSON (hex string)",
      "pattern": "^[a-f0-9]{64}$"
    },
    "config_epoch": {
      "type": "string",
      "description": "Database epoch identifier (UUID)",
      "format": "uuid"
    },
    "issued_at": {
      "type": "string",
      "description": "ISO 8601 timestamp when message was created",
      "format": "date-time"
    },
    "signature": {
      "type": "string",
      "description": "Ed25519 signature of (version|service|config|checksum|config_epoch|issued_at) as base64",
      "pattern": "^[A-Za-z0-9+/=]+$"
    }
  },
  "examples": [
    {
      "version": 1,
      "service": "stt-worker",
      "config": {
        "whisper_model": "base.en",
        "stt_backend": "whisper",
        "streaming_partials": false,
        "vad_threshold": 0.5
      },
      "checksum": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456",
      "config_epoch": "550e8400-e29b-41d4-a716-446655440000",
      "issued_at": "2025-10-17T12:00:00Z",
      "signature": "SGVsbG8gV29ybGQhIFRoaXMgaXMgYSBzaWduYXR1cmU="
    }
  ]
}
